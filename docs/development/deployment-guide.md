# éƒ¨ç½²æŒ‡å—

## ğŸš€ éƒ¨ç½²æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»é™ªç©ç®¡ç†ç³»ç»Ÿçš„éƒ¨ç½²æµç¨‹ï¼ŒåŒ…æ‹¬å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²æ–¹æ¡ˆã€‚

## ğŸ“‹ éƒ¨ç½²æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              è´Ÿè½½å‡è¡¡å±‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           Nginx                                        â”‚ â”‚
â”‚  â”‚  â€¢ è´Ÿè½½å‡è¡¡                    â”‚ â€¢ SSLç»ˆç«¯                   â”‚ â”‚
â”‚  â”‚  â€¢ é™æ€æ–‡ä»¶æœåŠ¡                â”‚ â€¢ è¯·æ±‚è·¯ç”±                  â”‚ â”‚
â”‚  â”‚  â€¢ ç¼“å­˜                       â”‚ â€¢ å®‰å…¨é˜²æŠ¤                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            åº”ç”¨å±‚                      â”‚ â”‚            æ•°æ®å±‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚       Node.js Cluster          â”‚   â”‚ â”‚  â”‚         MySQL Master           â”‚   â”‚
â”‚  â”‚  â€¢ PM2 è¿›ç¨‹ç®¡ç†                â”‚   â”‚ â”‚  â”‚  â€¢ ä¸»æ•°æ®åº“                    â”‚   â”‚
â”‚  â”‚  â€¢ è‡ªåŠ¨é‡å¯                    â”‚   â”‚ â”‚  â”‚  â€¢ å†™æ“ä½œ                      â”‚   â”‚
â”‚  â”‚  â€¢ æ—¥å¿—ç®¡ç†                    â”‚   â”‚ â”‚  â”‚  â€¢ æ•°æ®å¤‡ä»½                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚ â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          Redis Cluster          â”‚   â”‚ â”‚  â”‚         MySQL Slaves           â”‚   â”‚
â”‚  â”‚  â€¢ ä¼šè¯å­˜å‚¨                    â”‚   â”‚ â”‚  â”‚  â€¢ è¯»æ“ä½œ                      â”‚   â”‚
â”‚  â”‚  â€¢ ç¼“å­˜                        â”‚   â”‚ â”‚  â”‚  â€¢ è´Ÿè½½å‡è¡¡                    â”‚   â”‚
â”‚  â”‚  â€¢ æ¶ˆæ¯é˜Ÿåˆ—                    â”‚   â”‚ â”‚  â”‚  â€¢ é«˜å¯ç”¨                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¯å¢ƒé…ç½®

#### å¼€å‘ç¯å¢ƒ
- å•æœºéƒ¨ç½²
- çƒ­é‡è½½æ”¯æŒ
- è¯¦ç»†æ—¥å¿—è¾“å‡º
- è°ƒè¯•å·¥å…·

#### æµ‹è¯•ç¯å¢ƒ
- æ¨¡æ‹Ÿç”Ÿäº§é…ç½®
- è‡ªåŠ¨åŒ–æµ‹è¯•
- æ€§èƒ½ç›‘æ§
- é”™è¯¯è¿½è¸ª

#### ç”Ÿäº§ç¯å¢ƒ
- é«˜å¯ç”¨éƒ¨ç½²
- è´Ÿè½½å‡è¡¡
- æ•°æ®å¤‡ä»½
- å®‰å…¨é˜²æŠ¤

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### æœåŠ¡å™¨è¦æ±‚

#### æœ€ä½é…ç½®
- **CPU**: 2æ ¸å¿ƒ
- **å†…å­˜**: 4GB RAM
- **å­˜å‚¨**: 50GB SSD
- **ç½‘ç»œ**: 10Mbps
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTS æˆ– CentOS 8+

#### æ¨èé…ç½®
- **CPU**: 4æ ¸å¿ƒ
- **å†…å­˜**: 8GB RAM
- **å­˜å‚¨**: 100GB SSD
- **ç½‘ç»œ**: 100Mbps
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 LTS

### è½¯ä»¶ä¾èµ–

#### ç³»ç»Ÿè½¯ä»¶
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install -y \
  curl \
  wget \
  git \
  nginx \
  nodejs \
  npm \
  mysql-server \
  redis-server

# CentOS/RHEL
sudo yum update -y
sudo yum install -y \
  curl \
  wget \
  git \
  nginx \
  nodejs \
  npm \
  mysql-server \
  redis
```

#### Node.jsç‰ˆæœ¬
```bash
# ä½¿ç”¨NVMå®‰è£…Node.js
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18
nvm alias default 18
```

## ğŸ³ Dockeréƒ¨ç½²

### Dockerfile (åç«¯)
```dockerfile
# backend/Dockerfile
FROM node:18-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci --only=production

# å¤åˆ¶æºä»£ç 
COPY . .

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# åˆ‡æ¢ç”¨æˆ·
USER nextjs

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨åº”ç”¨
CMD ["npm", "start"]
```

### Dockerfile (å‰ç«¯)
```dockerfile
# frontend-react/Dockerfile
FROM node:18-alpine AS build

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm ci

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN npm run build

# ç”Ÿäº§ç¯å¢ƒ
FROM nginx:alpine

# å¤åˆ¶æ„å»ºæ–‡ä»¶
COPY --from=build /app/dist /usr/share/nginx/html

# å¤åˆ¶nginxé…ç½®
COPY nginx.conf /etc/nginx/nginx.conf

# æš´éœ²ç«¯å£
EXPOSE 80

# å¯åŠ¨nginx
CMD ["nginx", "-g", "daemon off;"]
```

### Docker Compose
```yaml
# docker-compose.yml
version: '3.8'

services:
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - backend
      - frontend
    restart: unless-stopped

  backend:
    build: ./backend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=mysql
      - DB_USER=playmanager
      - DB_PASSWORD=your_password
      - DB_DATABASE=playmanager
      - REDIS_HOST=redis
      - JWT_SECRET=your_jwt_secret
    depends_on:
      - mysql
      - redis
    restart: unless-stopped

  frontend:
    build: ./frontend-react
    ports:
      - "5173:80"
    environment:
      - VITE_API_BASE_URL=https://api.yourdomain.com
      - VITE_WS_URL=wss://api.yourdomain.com
    restart: unless-stopped

  mysql:
    image: mysql:8.0
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=root_password
      - MYSQL_DATABASE=playmanager
      - MYSQL_USER=playmanager
      - MYSQL_PASSWORD=your_password
    volumes:
      - mysql_data:/var/lib/mysql
      - ./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    restart: unless-stopped

volumes:
  mysql_data:
  redis_data:
```

## ğŸ“¦ ä¼ ç»Ÿéƒ¨ç½²

### 1. æœåŠ¡å™¨åˆå§‹åŒ–

#### åˆ›å»ºåº”ç”¨ç”¨æˆ·
```bash
# åˆ›å»ºåº”ç”¨ç”¨æˆ·
sudo useradd -m -s /bin/bash playmanager
sudo usermod -aG sudo playmanager

# åˆ‡æ¢åˆ°åº”ç”¨ç”¨æˆ·
sudo su - playmanager
```

#### å®‰è£…Node.js
```bash
# ä¸‹è½½å¹¶å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# éªŒè¯å®‰è£…
node --version
npm --version
```

### 2. æ•°æ®åº“é…ç½®

#### MySQLå®‰è£…
```bash
# å®‰è£…MySQL
sudo apt update
sudo apt install mysql-server

# å®‰å…¨é…ç½®
sudo mysql_secure_installation

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
mysql -u root -p
```

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE playmanager CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·
CREATE USER 'playmanager'@'localhost' IDENTIFIED BY 'your_password';

-- æˆæƒç”¨æˆ·
GRANT ALL PRIVILEGES ON playmanager.* TO 'playmanager'@'localhost';
FLUSH PRIVILEGES;

-- é€€å‡ºMySQL
EXIT;
```

#### Rediså®‰è£…
```bash
# å®‰è£…Redis
sudo apt install redis-server

# é…ç½®Redis
sudo cp /etc/redis/redis.conf /etc/redis/redis.conf.backup

# ç¼–è¾‘é…ç½®
sudo nano /etc/redis/redis.conf
```

#### Redisé…ç½®
```ini
# /etc/redis/redis.conf
bind 127.0.0.1
port 6379
daemonize yes
supervised systemd
maxmemory 256mb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
save 60 10000
```

### 3. åº”ç”¨éƒ¨ç½²

#### åç«¯éƒ¨ç½²
```bash
# å…‹éš†ä»£ç 
git clone <repository-url> playmanager
cd playmanager/backend

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºåº”ç”¨
npm run build

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
cat > .env << EOF
NODE_ENV=production
PORT=3000
DB_HOST=localhost
DB_PORT=3306
DB_USER=playmanager
DB_PASSWORD=your_password
DB_DATABASE=playmanager
REDIS_HOST=localhost
REDIS_PORT=6379
JWT_SECRET=your_jwt_secret_key_here
LOG_LEVEL=info
EOF

# åˆå§‹åŒ–æ•°æ®åº“
mysql -u playmanager -p playmanager < ../scripts/init-db.sql

# å¯åŠ¨åº”ç”¨
pm2 start server.js --name "playmanager-backend"
```

#### å‰ç«¯éƒ¨ç½²
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd ../frontend-react

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºåº”ç”¨
npm run build

# é…ç½®ç¯å¢ƒå˜é‡
cat > .env.production << EOF
VITE_API_BASE_URL=https://api.yourdomain.com
VITE_WS_URL=wss://api.yourdomain.com
VITE_APP_TITLE=é™ªç©ç®¡ç†ç³»ç»Ÿ
EOF

# ä½¿ç”¨serveå¯åŠ¨é™æ€æ–‡ä»¶
npm install -g serve
pm2 start serve --name "playmanager-frontend" -- --single -s build -l 5173
```

### 4. Nginxé…ç½®

#### å®‰è£…Nginx
```bash
# å®‰è£…Nginx
sudo apt install nginx

# å¯åŠ¨Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### Nginxé…ç½®æ–‡ä»¶
```nginx
# /etc/nginx/sites-available/playmanager
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;
    
    # SSLé…ç½®
    ssl_certificate /path/to/your/cert.pem;
    ssl_certificate_key /path/to/your/private.key;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;
    ssl_session_tickets off;
    
    # ç°ä»£åŠ å¯†å¥—ä»¶
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;
    
    # HSTS
    add_header Strict-Transport-Security "max-age=63072000" always;
    
    # å®‰å…¨å¤´éƒ¨
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Referrer-Policy "strict-origin-when-cross-origin";
    
    # é™æ€æ–‡ä»¶ç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # WebSocketä»£ç†
    location /socket.io/ {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # å‰ç«¯åº”ç”¨
    location / {
        proxy_pass http://localhost:5173;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # å¯ç”¨gzipå‹ç¼©
        gzip on;
        gzip_vary on;
        gzip_min_length 1024;
        gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    }
    
    # å¥åº·æ£€æŸ¥
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}
```

#### å¯ç”¨é…ç½®
```bash
# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/playmanager /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½Nginx
sudo systemctl reload nginx
```

## ğŸ”§ PM2è¿›ç¨‹ç®¡ç†

### PM2é…ç½®æ–‡ä»¶
```json
// ecosystem.config.js
module.exports = {
  apps: [
    {
      name: 'playmanager-backend',
      script: 'server.js',
      cwd: '/home/playmanager/playmanager/backend',
      instances: 'max',
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'production',
        PORT: 3000,
        DB_HOST: 'localhost',
        DB_USER: 'playmanager',
        DB_PASSWORD: 'your_password',
        DB_DATABASE: 'playmanager',
        REDIS_HOST: 'localhost',
        JWT_SECRET: 'your_jwt_secret'
      },
      log_file: '/var/log/pm2/playmanager-backend.log',
      out_file: '/var/log/pm2/playmanager-backend-out.log',
      error_file: '/var/log/pm2/playmanager-backend-error.log',
      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
      merge_logs: true,
      max_memory_restart: '1G',
      max_restarts: 5,
      min_uptime: '10s'
    },
    {
      name: 'playmanager-frontend',
      script: 'serve',
      cwd: '/home/playmanager/playmanager/frontend-react',
      instances: 2,
      exec_mode: 'cluster',
      env: {
        NODE_ENV: 'production'
      },
      args: '--single -s build -l 5173',
      log_file: '/var/log/pm2/playmanager-frontend.log',
      out_file: '/var/log/pm2/playmanager-frontend-out.log',
      error_file: '/var/log/pm2/playmanager-frontend-error.log',
      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
      merge_logs: true
    }
  ]
};
```

### PM2å‘½ä»¤
```bash
# å®‰è£…PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
pm2 start ecosystem.config.js

# æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs

# é‡å¯åº”ç”¨
pm2 restart playmanager-backend
pm2 restart playmanager-frontend

# åœæ­¢åº”ç”¨
pm2 stop playmanager-backend
pm2 stop playmanager-frontend

# åˆ é™¤åº”ç”¨
pm2 delete playmanager-backend
pm2 delete playmanager-frontend

# ä¿å­˜PM2é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

## ğŸ”’ å®‰å…¨é…ç½®

### é˜²ç«å¢™é…ç½®
```bash
# å®‰è£…UFW
sudo apt install ufw

# é»˜è®¤ç­–ç•¥
sudo ufw default deny incoming
sudo ufw default allow outgoing

# å…è®¸å¿…è¦ç«¯å£
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

### SSLè¯ä¹¦é…ç½®

#### Let's Encryptå…è´¹è¯ä¹¦
```bash
# å®‰è£…Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

#### è‡ªç­¾åè¯ä¹¦ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```bash
# ç”Ÿæˆç§é’¥
openssl genrsa -out server.key 2048

# ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚
openssl req -new -key server.key -out server.csr

# ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt

# åˆ›å»ºDHå‚æ•°
openssl dhparam -out dhparam.pem 2048
```

### ç³»ç»Ÿå®‰å…¨åŠ å›º

#### SSHå®‰å…¨
```bash
# ç¼–è¾‘SSHé…ç½®
sudo nano /etc/ssh/sshd_config

# ä¿®æ”¹ä»¥ä¸‹é…ç½®
Port 22
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
MaxAuthTries 3
LoginGraceTime 60
```

#### ç³»ç»Ÿæ›´æ–°
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å®‰å…¨æ›´æ–°
sudo apt install -y unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### åº”ç”¨ç›‘æ§

#### PM2ç›‘æ§
```bash
# å®‰è£…PM2ç›‘æ§é¢æ¿
pm2 install pm2-web

# å¯åŠ¨ç›‘æ§
pm2-web

# è®¿é—® http://localhost:9615
```

#### å¥åº·æ£€æŸ¥ç«¯ç‚¹
```javascript
// backend/routes/health.js
import { pool } from '../config/database';
import { logger } from '../utils/logger';

export const healthCheck = async (req, res) => {
  const health = {
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    version: process.env.npm_package_version || '1.0.0',
    checks: {
      database: 'unknown',
      redis: 'unknown',
      memory: 'unknown'
    }
  };

  // æ£€æŸ¥æ•°æ®åº“è¿æ¥
  try {
    await pool.execute('SELECT 1');
    health.checks.database = 'ok';
  } catch (error) {
    health.checks.database = 'error';
    health.status = 'degraded';
  }

  // æ£€æŸ¥Redisè¿æ¥
  try {
    const redis = require('../config/redis');
    await redis.ping();
    health.checks.redis = 'ok';
  } catch (error) {
    health.checks.redis = 'error';
    health.status = 'degraded';
  }

  // æ£€æŸ¥å†…å­˜ä½¿ç”¨
  const used = process.memoryUsage();
  const total = require('os').totalmem();
  const memoryPercent = (used.rss / total) * 100;
  
  health.checks.memory = memoryPercent > 90 ? 'critical' : 'ok';
  
  if (health.checks.memory === 'critical') {
    health.status = 'critical';
  }

  const statusCode = health.status === 'ok' ? 200 : 503;
  res.status(statusCode).json(health);
};
```

### æ—¥å¿—ç®¡ç†

#### æ—¥å¿—è½®è½¬é…ç½®
```bash
# åˆ›å»ºlogrotateé…ç½®
sudo nano /etc/logrotate.d/playmanager
```

```conf
# /etc/logrotate.d/playmanager
/var/log/pm2/*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    create 0644 playmanager playmanager
    postrotate
        pm2 reload playmanager-backend
        pm2 reload playmanager-frontend
    endscript
}
```

#### ç»“æ„åŒ–æ—¥å¿—
```javascript
// backend/utils/logger.js
import winston from 'winston';
import 'winston-daily-rotate-file';

const logFormat = winston.format.combine(
  winston.format.timestamp(),
  winston.format.errors({ stack: true }),
  winston.format.json()
);

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: logFormat,
  defaultMeta: { service: 'playmanager-api' },
  transports: [
    new winston.transports.DailyRotateFile({
      filename: 'logs/error-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      level: 'error',
      maxFiles: '14d',
      maxSize: '20m'
    }),
    new winston.transports.DailyRotateFile({
      filename: 'logs/combined-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      maxFiles: '30d',
      maxSize: '20m'
    })
  ]
});

export default logger;
```

## ğŸ”„ éƒ¨ç½²è„šæœ¬

### è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
```bash
#!/bin/bash
# scripts/deploy.sh

set -e

# é…ç½®å˜é‡
PROJECT_NAME="playmanager"
DEPLOY_USER="playmanager"
DEPLOY_PATH="/home/$DEPLOY_USER/$PROJECT_NAME"
BACKUP_PATH="/home/$DEPLOY_USER/backups"
REPO_URL="https://github.com/yourusername/playmanager.git"

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

log() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')] $1${NC}"
}

warn() {
    echo -e "${YELLOW}[$(date +'%Y-%m-%d %H:%M:%S')] $1${NC}"
}

error() {
    echo -e "${RED}[$(date +'%Y-%m-%d %H:%M:%S')] $1${NC}"
}

# æ£€æŸ¥æ˜¯å¦ä¸ºrootç”¨æˆ·
if [[ $EUID -eq 0 ]]; then
    error "è¯·ä¸è¦ä½¿ç”¨rootç”¨æˆ·è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# åˆ›å»ºå¤‡ä»½ç›®å½•
log "åˆ›å»ºå¤‡ä»½ç›®å½•..."
mkdir -p $BACKUP_PATH

# å¤‡ä»½æ•°æ®åº“
log "å¤‡ä»½æ•°æ®åº“..."
mysqldump -u playmanager -p playmanager > $BACKUP_PATH/mysql_backup_$(date +%Y%m%d_%H%M%S).sql

# åœæ­¢æœåŠ¡
log "åœæ­¢PM2æœåŠ¡..."
pm2 stop $PROJECT_NAME-backend || true
pm2 stop $PROJECT_NAME-frontend || true

# å¤‡ä»½ç°æœ‰ä»£ç 
if [[ -d $DEPLOY_PATH ]]; then
    log "å¤‡ä»½ç°æœ‰ä»£ç ..."
    mv $DEPLOY_PATH $BACKUP_PATH/$PROJECT_NAME_$(date +%Y%m%d_%H%M%S)
fi

# å…‹éš†æ–°ä»£ç 
log "å…‹éš†æ–°ä»£ç ..."
git clone $REPO_URL $DEPLOY_PATH
cd $DEPLOY_PATH

# å®‰è£…ä¾èµ–
log "å®‰è£…åç«¯ä¾èµ–..."
cd backend
npm install --production

log "å®‰è£…å‰ç«¯ä¾èµ–..."
cd ../frontend-react
npm install --production

# æ„å»ºåº”ç”¨
log "æ„å»ºå‰ç«¯åº”ç”¨..."
npm run build

# å¯åŠ¨æœåŠ¡
log "å¯åŠ¨PM2æœåŠ¡..."
cd ../backend
pm2 start server.js --name "$PROJECT_NAME-backend"

cd ../frontend-react
pm2 start serve --name "$PROJECT_NAME-frontend" -- --single -s build -l 5173

# ä¿å­˜PM2é…ç½®
pm2 save

# æ¸…ç†æ—§å¤‡ä»½
log "æ¸…ç†è¶…è¿‡7å¤©çš„å¤‡ä»½..."
find $BACKUP_PATH -type d -name "$PROJECT_NAME_*" -mtime +7 -exec rm -rf {} \;
find $BACKUP_PATH -name "mysql_backup_*.sql" -mtime +7 -delete

log "éƒ¨ç½²å®Œæˆï¼"
pm2 status
```

### å›æ»šè„šæœ¬
```bash
#!/bin/bash
# scripts/rollback.sh

set -e

# é…ç½®å˜é‡
PROJECT_NAME="playmanager"
DEPLOY_USER="playmanager"
DEPLOY_PATH="/home/$DEPLOY_USER/$PROJECT_NAME"
BACKUP_PATH="/home/$DEPLOY_USER/backups"

# é¢œè‰²è¾“å‡º
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

log() {
    echo -e "${GREEN}[$(date +'%Y-%m-%d %H:%M:%S')] $1${NC}"
}

error() {
    echo -e "${RED}[$(date +'%Y-%m-%d %H:%M:%S')] $1${NC}"
}

# æŸ¥æ‰¾æœ€æ–°å¤‡ä»½
latest_backup=$(ls -td $BACKUP_PATH/${PROJECT_NAME}_* | head -1)

if [[ -z $latest_backup ]]; then
    error "æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶"
    exit 1
fi

log "æ‰¾åˆ°æœ€æ–°å¤‡ä»½: $latest_backup"

# åœæ­¢æœåŠ¡
log "åœæ­¢æœåŠ¡..."
pm2 stop $PROJECT_NAME-backend || true
pm2 stop $PROJECT_NAME-frontend || true

# æ¢å¤ä»£ç 
log "æ¢å¤ä»£ç ..."
rm -rf $DEPLOY_PATH
cp -r $latest_backup $DEPLOY_PATH

# å¯åŠ¨æœåŠ¡
log "å¯åŠ¨æœåŠ¡..."
cd $DEPLOY_PATH/backend
pm2 start server.js --name "$PROJECT_NAME-backend"

cd $DEPLOY_PATH/frontend-react
pm2 start serve --name "$PROJECT_NAME-frontend" -- --single -s build -l 5173

log "å›æ»šå®Œæˆï¼"
pm2 status
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### Nginxä¼˜åŒ–
```nginx
# /etc/nginx/nginx.conf
user www-data;
worker_processes auto;
pid /run/nginx.pid;

events {
    worker_connections 1024;
    multi_accept on;
}

http {
    # åŸºç¡€è®¾ç½®
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
    
    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;
    
    # ç¼“å­˜é…ç½®
    open_file_cache max=1000 inactive=20s;
    open_file_cache_valid 30s;
    open_file_cache_min_uses 2;
    open_file_cache_errors on;
    
    # åŒ…å«ç«™ç‚¹é…ç½®
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;
}
```

### Node.jsä¼˜åŒ–
```bash
# å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
echo "* soft nofile 65536" | sudo tee -a /etc/security/limits.conf
echo "* hard nofile 65536" | sudo tee -a /etc/security/limits.conf

# ç³»ç»Ÿå†…æ ¸ä¼˜åŒ–
echo "net.core.somaxconn = 65536" | sudo tee -a /etc/sysctl.conf
echo "net.ipv4.tcp_max_syn_backlog = 65536" | sudo tee -a /etc/sysctl.conf
echo "net.ipv4.tcp_syncookies = 1" | sudo tee -a /etc/sysctl.conf

# åº”ç”¨å†…æ ¸ä¼˜åŒ–
sudo sysctl -p
```

### æ•°æ®åº“ä¼˜åŒ–
```sql
-- MySQLé…ç½®ä¼˜åŒ–
SET GLOBAL innodb_buffer_pool_size = 1G;
SET GLOBAL innodb_log_file_size = 256M;
SET GLOBAL innodb_log_buffer_size = 16M;
SET GLOBAL innodb_flush_log_at_trx_commit = 2;
SET GLOBAL innodb_flush_method = O_DIRECT;
SET GLOBAL innodb_file_per_table = 1;
SET GLOBAL innodb_buffer_pool_instances = 2;
SET GLOBAL query_cache_size = 0;
SET GLOBAL query_cache_type = 0;
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. åº”ç”¨æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep :3000
sudo netstat -tulpn | grep :5173

# æ£€æŸ¥PM2çŠ¶æ€
pm2 status
pm2 logs

# æ£€æŸ¥ç³»ç»Ÿèµ„æº
htop
df -h
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥MySQLçŠ¶æ€
sudo systemctl status mysql

# æ£€æŸ¥è¿æ¥
mysql -u playmanager -p -h localhost playmanager

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

#### 3. Nginxé…ç½®é”™è¯¯
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx
```

#### 4. SSLè¯ä¹¦é—®é¢˜
```bash
# æ£€æŸ¥è¯ä¹¦çŠ¶æ€
sudo certbot certificates

# å¼ºåˆ¶æ›´æ–°è¯ä¹¦
sudo certbot renew --force-renewal

# æ£€æŸ¥è¯ä¹¦é“¾
openssl s_client -connect yourdomain.com:443 -servername yourdomain.com
```

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 logs playmanager-backend --lines 100
pm2 logs playmanager-frontend --lines 100

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u nginx -f
sudo journalctl -u mysql -f

# æŸ¥çœ‹è®¤è¯æ—¥å¿—
sudo journalctl -u sshd -f
```

---

*æœ¬æ–‡æ¡£æä¾›äº†é™ªç©ç®¡ç†ç³»ç»Ÿçš„å®Œæ•´éƒ¨ç½²æŒ‡å—ï¼ŒåŒ…æ‹¬ç¯å¢ƒå‡†å¤‡ã€åº”ç”¨éƒ¨ç½²ã€å®‰å…¨é…ç½®å’Œæ•…éšœæ’é™¤ã€‚*

**æœ€åæ›´æ–°**: 2025-08-26  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**è´Ÿè´£äºº**: è¿ç»´å›¢é˜Ÿ